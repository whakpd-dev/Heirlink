# Запуск HeirLink на телефоне

## 1. Один раз: повысить лимит файлов (macOS)

Чтобы Metro не падал с ошибкой **«EMFILE: too many open files»** после появления QR-кода, выполни **один раз** (попросит пароль):

```bash
cd /Volumes/alim/HeirLink/mobile
sudo bash scripts/fix-ulimit-macos.sh
```

**Закрой и заново открой терминал** — после этого `npm start` будет работать стабильно.

Подробнее: [EMFILE_FIX.md](./EMFILE_FIX.md) и [../docs/macos/README.md](../docs/macos/README.md).

---

## 2. Запустить бэкенд

В **первом терминале**:

```bash
cd /Volumes/alim/HeirLink/backend
npm run dev
```

Должно быть сообщение вроде: `Nest application successfully started`, порт 3000.

---

## 3. Запустить Expo (с QR-кодом)

Во **втором терминале**:

```bash
cd /Volumes/alim/HeirLink/mobile
npm start
```

Появится QR-код и меню. **Не закрывай этот терминал.**

---

## 4. Подключить телефон

1. **Телефон и Mac в одной Wi‑Fi сети.**
2. Установи на телефон **Expo Go**:
   - [App Store (iOS)](https://apps.apple.com/app/expo-go/id982107779)
   - [Google Play (Android)](https://play.google.com/store/apps/details?id=host.exp.exponent)
3. **iOS:** открой камеру и отсканируй QR-код из терминала → откроется Expo Go с приложением.
4. **Android:** открой Expo Go → «Scan QR code» → отсканируй QR-код из терминала.

Приложение подхватит IP твоего Mac с бэкендом само (тот же хост, что и Metro).

---

## Если не подключается

- Убедись, что телефон и Mac в одной Wi‑Fi.
- На Mac не должен быть включён VPN, блокирующий локальную сеть.
- **iOS:** если камера не открывает Expo Go по QR — открой Expo Go вручную и введи URL, который показан в терминале под QR (например `exp://192.168.1.5:8081`).
- Если бэкенд на другом порту или другом компьютере — в `mobile` создай `.env` и укажи:
  ```
  EXPO_PUBLIC_API_URL=http://IP_КОМПЬЮТЕРА:3000
  ```

---

## Если приложение ходит на удалённый сервер (5.129.198.32)

В `mobile` по умолчанию используется `EXPO_PUBLIC_API_URL=http://5.129.198.32`. Чтобы **посты публиковались** и лента работала, на этом сервере должен быть запущен **актуальный бэкенд**:

1. На сервере: `cd backend && npm install && npx prisma generate && npm run build && npm run start:prod` (или через PM2/Docker).
2. Должны быть доступны маршруты: `/api/auth/*`, `/api/posts/*`, `/api/upload`, `/api/users/*`, `/api/stories`, `/api/notifications` и т.д.
3. База данных: задай `DATABASE_URL` в `.env` на сервере и выполни `npx prisma migrate deploy`.

Если бэкенд не обновлён или не запущен, в приложении будут 404 при загрузке ленты, публикации поста и т.д. Сообщение об ошибке при публикации подскажет: «Проверьте, что сервер запущен и доступен».

---

## Кратко

| Шаг | Команда / действие |
|-----|---------------------|
| 1 (один раз) | `sudo launchctl limit maxfiles 65536 200000` |
| 2 | Терминал 1: `cd backend && npm run dev` |
| 3 | Терминал 2: `cd mobile && npm start` |
| 4 | Телефон в той же Wi‑Fi → Expo Go → сканировать QR из терминала |
