# План разработки HeirLink - Платформа для фото/видео с ИИ-функциями

## 1. Обзор проекта

**HeirLink** - социальная платформа для обмена фото и видео с уникальными возможностями:
- 📸 Классическая функциональность Instagram (лента, истории, профили)
- 🎨 **Уникальная фича**: Умный альбом с ИИ-анализом
  - Оживление статичных фото (AI Animation)
  - Восстановление старых/поврежденных фото (AI Restoration)
  - Автоматическое определение момента жизни и локации
  - Построение карты жизни пользователя

## 2. Технологический стек

### Frontend (Mobile)
- **React Native** или **Expo** - для кроссплатформенной разработки
- **TypeScript** - для типобезопасности
- **React Navigation** - навигация между экранами
- **Redux Toolkit** или **Zustand** - управление состоянием
- **React Query / TanStack Query** - кэширование и синхронизация данных
- **React Native Image Picker** - выбор медиа
- **React Native Camera** - камера для съемки
- **React Native Reanimated** - плавные анимации
- **React Native Gesture Handler** - жесты

### Backend
- **Node.js + Express** или **NestJS** - API сервер
- **PostgreSQL** - основная БД
- **Redis** - кэширование и сессии
- **AWS S3** или **Cloudinary** - хранение медиа
- **WebSocket (Socket.io)** - real-time уведомления

### ИИ/ML сервисы
- **Python FastAPI** - микросервис для ИИ-обработки
- **OpenAI API** или **Anthropic Claude** - анализ контента
- **Stable Diffusion / AnimateDiff** - оживление фото
- **ESRGAN / Real-ESRGAN** - восстановление фото
- **CLIP / BLIP** - анализ изображений (определение сцены, локации)
- **Google Vision API** или **AWS Rekognition** - распознавание объектов/лиц
- **Mapbox / Google Maps API** - геолокация и карты

### Инфраструктура
- **Docker** - контейнеризация
- **Kubernetes** (опционально) - оркестрация
- **Nginx** - reverse proxy
- **CI/CD** - GitHub Actions / GitLab CI

## 3. Архитектура системы

```
┌─────────────────────────────────────────────────────────┐
│                    Mobile App (React Native)            │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐│
│  │   Feed   │  │ Explore  │  │  Create  │  │ Profile  ││
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘│
│  ┌────────────────────────────────────────────────────┐ │
│  │         Smart Album (Уникальная фича)              │ │
│  │  - AI Animation  - AI Restoration  - Life Map     │ │
│  └────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│              API Gateway (NestJS/Express)                │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐│
│  │   Auth   │  │  Posts   │  │  Users   │  │  Stories ││
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘│
└─────────────────────────────────────────────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        ▼                 ▼                 ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  PostgreSQL  │  │     Redis    │  │  Media Store │
│   (Main DB)  │  │   (Cache)    │  │   (S3/CDN)   │
└──────────────┘  └──────────────┘  └──────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│            AI Processing Service (FastAPI)              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │   Animation  │  │ Restoration  │  │   Analysis   │ │
│  │   Service    │  │   Service    │  │   Service    │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
└─────────────────────────────────────────────────────────┘
```

## 4. Структура проекта

```
HeirLink/
├── mobile/                    # React Native приложение
│   ├── src/
│   │   ├── screens/          # Экраны приложения
│   │   │   ├── Feed/
│   │   │   ├── Explore/
│   │   │   ├── Create/
│   │   │   ├── Activity/
│   │   │   ├── Profile/
│   │   │   └── SmartAlbum/   # Уникальный модуль
│   │   ├── components/       # Переиспользуемые компоненты
│   │   │   ├── PostCard/
│   │   │   ├── StoriesRail/
│   │   │   ├── BottomNav/
│   │   │   └── ...
│   │   ├── navigation/       # Навигация
│   │   ├── store/            # State management
│   │   ├── services/         # API клиенты
│   │   ├── hooks/            # Custom hooks
│   │   ├── utils/            # Утилиты
│   │   └── types/            # TypeScript типы
│   ├── assets/
│   └── package.json
│
├── backend/                   # Node.js/NestJS API
│   ├── src/
│   │   ├── auth/             # Аутентификация
│   │   ├── users/            # Пользователи
│   │   ├── posts/            # Посты
│   │   ├── stories/          # Истории
│   │   ├── comments/         # Комментарии
│   │   ├── likes/            # Лайки
│   │   ├── follows/          # Подписки
│   │   ├── media/            # Загрузка медиа
│   │   └── smart-album/      # Умный альбом API
│   ├── prisma/               # Prisma ORM схемы
│   └── package.json
│
├── ai-service/                # Python FastAPI сервис
│   ├── services/
│   │   ├── animation/        # Оживление фото
│   │   ├── restoration/      # Восстановление фото
│   │   ├── analysis/         # Анализ изображений
│   │   └── life-map/         # Построение карты жизни
│   ├── models/               # ML модели
│   ├── utils/
│   └── requirements.txt
│
├── shared/                    # Общие типы/контракты
│   └── types/
│
└── docs/                      # Документация
```

## 5. Основные модули (Детальная спецификация)

### 5.1. Лента (Feed Screen)

**Компоненты:**
- `FeedHeader` - Верхняя панель с логотипом и иконкой сообщений
- `StoriesRail` - Горизонтальный скролл историй
  - Аватары пользователей
  - Индикатор просмотра (серая/цветная обводка)
  - Tap для открытия истории
- `PostCard` - Карточка поста
  - Заголовок: аватар + имя + время
  - Медиа (фото/видео) с swipe для карусели
  - Действия: лайк, комментарий, поделиться, сохранить
  - Описание и комментарии (первые 2-3)
  - Кнопка "Показать все комментарии"

**Функционал:**
- Pull-to-refresh
- Infinite scroll (пагинация)
- Лайки в реальном времени
- Уведомления о новых постах

### 5.2. Поиск (Explore Screen)

**Компоненты:**
- `SearchBar` - Поисковая строка с фильтрами
- `ExploreGrid` - Сетка контента (Masonry layout)
  - Миниатюры постов
  - Tap для открытия детального просмотра

**Функционал:**
- Поиск по хештегам, пользователям, локациям
- Трендовые посты
- Рекомендации на основе интересов

### 5.3. Создание поста (Create/Upload Screen)

**Компоненты:**
- `MediaPicker` - Выбор медиа из галереи или камеры
- `MediaEditor` - Редактирование
  - Базовые фильтры
  - Обрезка
  - Текст/стикеры
- `PostDetails` - Описание поста
  - Текст описания
  - Хештеги
  - Локация
  - Отметка друзей
  - Настройки приватности

**Функционал:**
- Поддержка множественных фото/видео
- Предпросмотр перед публикацией
- Сохранение черновиков

### 5.4. Активность (Activity/Notifications Screen)

**Компоненты:**
- `NotificationItem` - Элемент уведомления
  - Аватар пользователя
  - Тип действия (лайк, комментарий, подписка)
  - Медиа превью (для лайков/комментариев)
  - Время

**Типы уведомлений:**
- Лайки на посты
- Комментарии
- Подписки
- Упоминания
- Ответы на комментарии

**Функционал:**
- Real-time обновления (WebSocket)
- Группировка уведомлений
- Отметка как прочитанное

### 5.5. Профиль (Profile Screen)

**Компоненты:**
- `ProfileHeader` - Шапка профиля
  - Аватар (большой)
  - Статистика: посты, подписчики, подписки
  - Кнопка "Редактировать профиль" / "Подписаться"
  - Кнопка "Поделиться профилем"
- `Highlights` - Хайлайты (Актуальное)
  - Круглые миниатюры с обложками
  - Tap для просмотра историй
- `ProfileTabs` - Табы переключения
  - Сетка постов (Grid)
  - Отмеченные (Tagged)
  - Сохраненные (Saved)

**Функционал:**
- Просмотр своего/чужого профиля
- Редактирование профиля
- Настройки приватности

### 5.6. Умный альбом (Smart Album) - УНИКАЛЬНАЯ ФИЧА

**Основные функции:**

#### 5.6.1. Оживление фото (AI Animation)
- Загрузка статичного фото
- Обработка через AI (AnimateDiff, Stable Video Diffusion)
- Создание короткого видео (2-5 сек) с плавным движением
- Сохранение в альбоме как "оживленное фото"

**UI:**
- `PhotoAnimationCard` - Карточка с оригиналом и оживленной версией
- Кнопка "Оживить" на фото
- Прогресс-бар обработки
- Предпросмотр результата

#### 5.6.2. Восстановление фото (AI Restoration)
- Загрузка старого/поврежденного фото
- Обработка через AI (ESRGAN, Real-ESRGAN)
- Улучшение качества, удаление шумов, восстановление деталей
- Цветизация черно-белых фото (опционально)

**UI:**
- `RestorationCard` - До/После сравнение
- Слайдер для сравнения
- Кнопка "Восстановить"
- Настройки уровня восстановления

#### 5.6.3. Анализ момента жизни (AI Analysis)
- Автоматический анализ загруженного фото
- Определение:
  - Тип события (день рождения, свадьба, отпуск, праздник и т.д.)
  - Эмоции людей на фото
  - Примерная дата (по стилю, одежде, технологиям)
  - Локация (если есть геотеги или распознавание фона)
  - Погода, время суток
  - Количество людей

**UI:**
- `LifeMomentCard` - Карточка момента
  - Фото
  - Теги события
  - Предполагаемая дата
  - Локация на карте
  - Эмоции участников

#### 5.6.4. Карта жизни (Life Map)
- Визуализация всех моментов на временной шкале
- Группировка по событиям, локациям, людям
- Интерактивная карта с маркерами фото
- Фильтры: по дате, типу события, локации, людям

**UI:**
- `LifeMapView` - Интерактивная карта
- `TimelineView` - Временная шкала
- `EventGroups` - Группировка по событиям
- `PeopleTags` - Теги людей

**Компоненты:**
- `SmartAlbumScreen` - Главный экран умного альбома
- `AnimationViewer` - Просмотр оживленных фото
- `RestorationViewer` - Просмотр восстановленных фото
- `LifeMapView` - Карта жизни
- `MomentDetails` - Детали момента

## 6. База данных (Схема)

### Основные таблицы:

```sql
-- Пользователи
users (
  id, email, username, password_hash, 
  avatar_url, bio, created_at, updated_at
)

-- Посты
posts (
  id, user_id, caption, location, 
  created_at, updated_at, is_deleted
)

-- Медиа
media (
  id, post_id, url, type (photo/video),
  thumbnail_url, order, created_at
)

-- Лайки
likes (
  id, user_id, post_id, created_at
)

-- Комментарии
comments (
  id, post_id, user_id, text, 
  parent_id (для ответов), created_at
)

-- Подписки
follows (
  id, follower_id, following_id, created_at
)

-- Истории
stories (
  id, user_id, media_url, type,
  expires_at, created_at
)

-- Умный альбом
smart_album_items (
  id, user_id, original_media_id,
  animated_version_id, restored_version_id,
  ai_analysis (JSON), life_moment_tags (JSON),
  location_data (JSON), created_at
)

-- AI анализ
ai_analyses (
  id, media_id, event_type, emotions,
  estimated_date, location, weather,
  people_count, metadata (JSON), created_at
)
```

## 7. API Endpoints

### Аутентификация
- `POST /api/auth/register` - Регистрация
- `POST /api/auth/login` - Вход
- `POST /api/auth/refresh` - Обновление токена
- `POST /api/auth/logout` - Выход

### Посты
- `GET /api/posts` - Лента постов (пагинация)
- `GET /api/posts/:id` - Детали поста
- `POST /api/posts` - Создание поста
- `DELETE /api/posts/:id` - Удаление поста
- `POST /api/posts/:id/like` - Лайк поста
- `DELETE /api/posts/:id/like` - Убрать лайк

### Комментарии
- `GET /api/posts/:id/comments` - Комментарии поста
- `POST /api/posts/:id/comments` - Добавить комментарий
- `DELETE /api/comments/:id` - Удалить комментарий

### Пользователи
- `GET /api/users/:id` - Профиль пользователя
- `PUT /api/users/:id` - Обновить профиль
- `GET /api/users/:id/posts` - Посты пользователя
- `POST /api/users/:id/follow` - Подписаться
- `DELETE /api/users/:id/follow` - Отписаться

### Истории
- `GET /api/stories` - Активные истории
- `POST /api/stories` - Создать историю
- `DELETE /api/stories/:id` - Удалить историю

### Умный альбом
- `GET /api/smart-album` - Все элементы альбома
- `POST /api/smart-album/animate` - Оживить фото
- `POST /api/smart-album/restore` - Восстановить фото
- `POST /api/smart-album/analyze` - Анализ фото
- `GET /api/smart-album/life-map` - Данные для карты жизни
- `GET /api/smart-album/timeline` - Временная шкала

### Поиск
- `GET /api/search` - Поиск (query param: q, type)

## 8. Этапы разработки

### Фаза 1: MVP (Минимально жизнеспособный продукт)
**Срок: 4-6 недель**

1. **Неделя 1-2: Настройка и базовая структура**
   - Инициализация проектов (mobile, backend, ai-service)
   - Настройка CI/CD, Docker
   - Базовая аутентификация
   - Схема БД

2. **Неделя 3-4: Основные экраны**
   - Feed (лента постов)
   - Profile (профиль)
   - Create (создание поста)
   - Базовая навигация

3. **Неделя 5-6: Социальные функции**
   - Лайки, комментарии
   - Подписки
   - Уведомления
   - Поиск

### Фаза 2: Расширенный функционал
**Срок: 3-4 недели**

4. **Неделя 7-8: Истории**
   - Создание историй
   - Просмотр историй
   - Хайлайты

5. **Неделя 9-10: Улучшения UX**
   - Анимации
   - Оптимизация производительности
   - Кэширование
   - Offline режим (базовый)

### Фаза 3: Уникальные фичи (Smart Album)
**Срок: 6-8 недель**

6. **Неделя 11-12: AI Restoration**
   - Интеграция моделей восстановления
   - API для обработки
   - UI для восстановления

7. **Неделя 13-14: AI Animation**
   - Интеграция моделей анимации
   - Обработка видео
   - UI для оживления

8. **Неделя 15-16: AI Analysis**
   - Интеграция анализа изображений
   - Определение событий, локаций
   - Сохранение метаданных

9. **Неделя 17-18: Life Map**
   - Визуализация карты
   - Временная шкала
   - Группировка событий
   - Фильтры

### Фаза 4: Полировка и масштабирование
**Срок: 4-6 недель**

10. **Неделя 19-22: Оптимизация**
    - Производительность
    - Масштабирование backend
    - Оптимизация AI обработки
    - CDN для медиа

11. **Неделя 23-24: Тестирование и багфиксы**
    - Unit тесты
    - Integration тесты
    - E2E тесты
    - Исправление багов

12. **Неделя 25-26: Подготовка к релизу**
    - Документация
    - App Store / Play Store подготовка
    - Бета-тестирование
    - Финальные правки

## 9. Технические детали

### 9.1. Обработка медиа
- Загрузка через multipart/form-data
- Конвертация видео в разные форматы
- Генерация миниатюр
- Оптимизация изображений (WebP, сжатие)
- CDN для быстрой доставки

### 9.2. AI Обработка
- Асинхронная обработка (очереди задач)
- Webhook для уведомления о завершении
- Кэширование результатов
- Ограничение по времени обработки
- Fallback на более быстрые модели

### 9.3. Real-time
- WebSocket для уведомлений
- Push-уведомления (Firebase Cloud Messaging)
- Обновление ленты в реальном времени

### 9.4. Безопасность
- JWT токены
- Rate limiting
- Валидация загружаемых файлов
- Защита от XSS, CSRF
- Шифрование чувствительных данных

## 10. Метрики успеха

- Время загрузки экранов < 2 сек
- FPS анимаций > 60
- Время обработки AI < 30 сек (для восстановления), < 60 сек (для анимации)
- Uptime > 99.5%
- Покрытие тестами > 70%

## 11. Следующие шаги

1. ✅ Создать структуру проектов
2. Настроить базовую конфигурацию
3. Реализовать аутентификацию
4. Создать первый экран (Feed)
5. Интегрировать AI сервисы

---

**Примечание:** Этот план является живым документом и будет обновляться по мере разработки.
